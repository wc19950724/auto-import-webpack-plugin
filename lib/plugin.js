"use strict";var e=require("node:fs"),t=require("node:path"),n=require("eslint"),r=require("prettier");function o(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function s(e){return Array.isArray(e)?e:[e]}const i=/^\s+$/,l=/(?:[^\\]|^)\\$/,a=/^\\!/,c=/^\\#/,u=/\r?\n/g,g=/^\.*\/|^\.+$/;let h="node-ignore";"undefined"!=typeof Symbol&&(h=Symbol.for("node-ignore"));const d=h,f=/([0-z])-([0-z])/g,p=()=>!1,b=[[/\\?\s+$/,e=>0===e.indexOf("\\")?" ":""],[/\\\s/g,()=>" "],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,n)=>t+6<n.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(e,t,n)=>t+n.replace(/\\\*/g,"[^\\/]*")],[/\\\\\\(?=[$.|*+(){^])/g,()=>"\\"],[/\\\\/g,()=>"\\"],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,n,r,o)=>"\\"===t?`\\[${n}${(e=>{const{length:t}=e;return e.slice(0,t-t%2)})(r)}${o}`:"]"===o&&r.length%2==0?`[${(e=>e.replace(f,((e,t,n)=>t.charCodeAt(0)<=n.charCodeAt(0)?e:"")))(n)}${r}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(e,t)=>`${t?`${t}[^/]+`:"[^/]*"}(?=$|\\/$)`]],m=Object.create(null),v=e=>"string"==typeof e;class y{constructor(e,t,n,r){this.origin=e,this.pattern=t,this.negative=n,this.regex=r}}const $=(e,t)=>{const n=e;let r=!1;0===e.indexOf("!")&&(r=!0,e=e.substr(1));const o=((e,t)=>{let n=m[e];return n||(n=b.reduce(((t,n)=>t.replace(n[0],n[1].bind(e))),e),m[e]=n),t?new RegExp(n,"i"):new RegExp(n)})(e=e.replace(a,"!").replace(c,"#"),t);return new y(n,e,r,o)},O=(e,t)=>{throw new t(e)},x=(e,t,n)=>{if(!v(e))return n(`path must be a string, but got \`${t}\``,TypeError);if(!e)return n("path must not be empty",TypeError);if(x.isNotRelative(e)){return n(`path should be a ${"`path.relative()`d"} string, but got "${t}"`,RangeError)}return!0},_=e=>g.test(e);x.isNotRelative=_,x.convert=e=>e;class w{constructor({ignorecase:e=!0,ignoreCase:t=e,allowRelativePaths:n=!1}={}){var r,o,s;r=this,o=d,s=!0,Object.defineProperty(r,o,{value:s}),this._rules=[],this._ignoreCase=t,this._allowRelativePaths=n,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(e){if(e&&e[d])return this._rules=this._rules.concat(e._rules),void(this._added=!0);if((e=>e&&v(e)&&!i.test(e)&&!l.test(e)&&0!==e.indexOf("#"))(e)){const t=$(e,this._ignoreCase);this._added=!0,this._rules.push(t)}}add(e){return this._added=!1,s(v(e)?(e=>e.split(u))(e):e).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,t){let n=!1,r=!1;return this._rules.forEach((o=>{const{negative:s}=o;if(r===s&&n!==r||s&&!n&&!r&&!t)return;o.regex.test(e)&&(n=!s,r=s)})),{ignored:n,unignored:r}}_test(e,t,n,r){const o=e&&x.convert(e);return x(o,e,this._allowRelativePaths?p:O),this._t(o,t,n,r)}_t(e,t,n,r){if(e in t)return t[e];if(r||(r=e.split("/")),r.pop(),!r.length)return t[e]=this._testOne(e,n);const o=this._t(r.join("/")+"/",t,n,r);return t[e]=o.ignored?o:this._testOne(e,n)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return s(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}}const j=e=>new w(e);j.isPathValid=e=>x(e&&x.convert(e),e,p),j.default=j;var A=j;if("undefined"!=typeof process&&(process.env&&process.env.IGNORE_TEST_WIN32||"win32"===process.platform)){const e=e=>/^\\\\\?\\/.test(e)||/["<>|\u0000-\u001F]+/u.test(e)?e:e.replace(/\\/g,"/");x.convert=e;const t=/^[a-z]:\//i;x.isNotRelative=e=>t.test(e)||_(e)}var B=o(A);const C=process.cwd(),S=B().add("node_modules"),T={entry:"/",output:"auto-import.js",resolvers:"element-ui",ignorePath:".generatorignore",logLevel:"info",check:!0};let M=T;const P=()=>M,E=(e=0)=>t=>`[${t+e}m`,R=(e=0)=>t=>`[${38+e};5;${t}m`,k=(e=0)=>(t,n,r)=>`[${38+e};2;${t};${n};${r}m`,L={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],gray:[90,39],grey:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgGray:[100,49],bgGrey:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};Object.keys(L.modifier);Object.keys(L.color),Object.keys(L.bgColor);const N=function(){const e=new Map;for(const[t,n]of Object.entries(L)){for(const[t,r]of Object.entries(n))L[t]={open:`[${r[0]}m`,close:`[${r[1]}m`},n[t]=L[t],e.set(r[0],r[1]);Object.defineProperty(L,t,{value:n,enumerable:!1})}return Object.defineProperty(L,"codes",{value:e,enumerable:!1}),L.color.close="[39m",L.bgColor.close="[49m",L.color.ansi=E(),L.color.ansi256=R(),L.color.ansi16m=k(),L.bgColor.ansi=E(10),L.bgColor.ansi256=R(10),L.bgColor.ansi16m=k(10),Object.defineProperties(L,{rgbToAnsi256:{value:(e,t,n)=>e===t&&t===n?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5),enumerable:!1},hexToRgb:{value(e){const t=/[a-f\d]{6}|[a-f\d]{3}/i.exec(e.toString(16));if(!t)return[0,0,0];let[n]=t;3===n.length&&(n=[...n].map((e=>e+e)).join(""));const r=Number.parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},enumerable:!1},hexToAnsi256:{value:e=>L.rgbToAnsi256(...L.hexToRgb(e)),enumerable:!1},ansi256ToAnsi:{value(e){if(e<8)return 30+e;if(e<16)return e-8+90;let t,n,r;if(e>=232)t=(10*(e-232)+8)/255,n=t,r=t;else{const o=(e-=16)%36;t=Math.floor(e/36)/5,n=Math.floor(o/6)/5,r=o%6/5}const o=2*Math.max(t,n,r);if(0===o)return 30;let s=30+(Math.round(r)<<2|Math.round(n)<<1|Math.round(t));return 2===o&&(s+=60),s},enumerable:!1},rgbToAnsi:{value:(e,t,n)=>L.ansi256ToAnsi(L.rgbToAnsi256(e,t,n)),enumerable:!1},hexToAnsi:{value:e=>L.ansi256ToAnsi(L.hexToAnsi256(e)),enumerable:!1}}),L}(),F=(()=>{if(navigator.userAgentData){const e=navigator.userAgentData.brands.find((({brand:e})=>"Chromium"===e));if(e&&e.version>93)return 3}return/\b(Chrome|Chromium)\//.test(navigator.userAgent)?1:0})(),G=0!==F&&{level:F,hasBasic:!0,has256:F>=2,has16m:F>=3},q={stdout:G,stderr:G};function z(e,t,n){let r=e.indexOf(t);if(-1===r)return e;const o=t.length;let s=0,i="";do{i+=e.slice(s,r)+t+n,s=r+o,r=e.indexOf(t,s)}while(-1!==r);return i+=e.slice(s),i}const{stdout:I,stderr:V}=q,W=Symbol("GENERATOR"),Y=Symbol("STYLER"),D=Symbol("IS_EMPTY"),U=["ansi","ansi","ansi256","ansi16m"],H=Object.create(null),J=e=>{const t=(...e)=>e.join(" ");return((e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const n=I?I.level:0;e.level=void 0===t.level?n:t.level})(t,e),Object.setPrototypeOf(t,K.prototype),t};function K(e){return J(e)}Object.setPrototypeOf(K.prototype,Function.prototype);for(const[e,t]of Object.entries(N))H[e]={get(){const n=te(this,ee(t.open,t.close,this[Y]),this[D]);return Object.defineProperty(this,e,{value:n}),n}};H.visible={get(){const e=te(this,this[Y],!0);return Object.defineProperty(this,"visible",{value:e}),e}};const Q=(e,t,n,...r)=>"rgb"===e?"ansi16m"===t?N[n].ansi16m(...r):"ansi256"===t?N[n].ansi256(N.rgbToAnsi256(...r)):N[n].ansi(N.rgbToAnsi(...r)):"hex"===e?Q("rgb",t,n,...N.hexToRgb(...r)):N[n][e](...r),X=["rgb","hex","ansi256"];for(const e of X){H[e]={get(){const{level:t}=this;return function(...n){const r=ee(Q(e,U[t],"color",...n),N.color.close,this[Y]);return te(this,r,this[D])}}};H["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const{level:t}=this;return function(...n){const r=ee(Q(e,U[t],"bgColor",...n),N.bgColor.close,this[Y]);return te(this,r,this[D])}}}}const Z=Object.defineProperties((()=>{}),{...H,level:{enumerable:!0,get(){return this[W].level},set(e){this[W].level=e}}}),ee=(e,t,n)=>{let r,o;return void 0===n?(r=e,o=t):(r=n.openAll+e,o=t+n.closeAll),{open:e,close:t,openAll:r,closeAll:o,parent:n}},te=(e,t,n)=>{const r=(...e)=>ne(r,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(r,Z),r[W]=e,r[Y]=t,r[D]=n,r},ne=(e,t)=>{if(e.level<=0||!t)return e[D]?"":t;let n=e[Y];if(void 0===n)return t;const{openAll:r,closeAll:o}=n;if(t.includes(""))for(;void 0!==n;)t=z(t,n.close,n.open),n=n.parent;const s=t.indexOf("\n");return-1!==s&&(t=function(e,t,n,r){let o=0,s="";do{const i="\r"===e[r-1];s+=e.slice(o,i?r-1:r)+t+(i?"\r\n":"\n")+n,o=r+1,r=e.indexOf("\n",o)}while(-1!==r);return s+=e.slice(o),s}(t,o,r,s)),r+t+o};Object.defineProperties(K.prototype,H);const re=K();K({level:V?V.level:0});var oe={error:function(...e){const{logLevel:t}=P();["error","warn","info"].indexOf(t)>-1&&console.log(re.redBright(...e))},warn:function(...e){const{logLevel:t}=P();["warn","info"].indexOf(t)>-1&&console.log(re.yellowBright(...e))},info:function(...e){const{logLevel:t}=P();["info"].indexOf(t)>-1&&console.log(re.blueBright(...e))},success:function(...e){const{logLevel:t}=P();["info"].indexOf(t)>-1&&console.log(re.greenBright(...e))},log:function(...e){const{logLevel:t}=P();["info"].indexOf(t)>-1&&console.log(...e)},path:function(...e){const{logLevel:t}=P();["info"].indexOf(t)>-1&&console.log(re.gray(...e))}};const se=e=>oe.success(`\n${e}`),ie=()=>{const e=P();return t.resolve(C,e.output)},le=n=>{const r=e.readdirSync(n,{withFileTypes:!0}),o=[];return r.forEach((r=>{if(S.ignores(r.name))return;const s=t.resolve(n,r.name),i=e.statSync(s);i.isDirectory()?o.push(...le(s)):i.isFile()&&r.name.endsWith(".vue")&&(oe.path(s),o.push(s))})),o},ae={Loading:{use:"Loading.directive",prototype:{loading:"Loading.service"}},MessageBox:{prototype:{msgbox:"MessageBox",alert:"MessageBox.alert",confirm:"MessageBox.confirm",prompt:"MessageBox.prompt"}},Notification:{prototype:{notify:"Notification"}},Message:{prototype:{message:"Message"}}},ce=e=>{const t=ae[e];if(!t)return`Vue.use(${e})`;const{use:n,prototype:r}=t,o=[];if(n&&o.push(`Vue.use(${n});`),r){const e=Object.entries(r).map((([e,t])=>`Vue.prototype.$${e} = ${t};`));o.push(...e)}return o.join("\n")},ue=async()=>{const n=P();se("scanning files...");const r=(()=>{const t=ie(),n=new Set;if(e.existsSync(t)){const r=/import\s*{([^}]*)}\s*from\s*['"]([^'"]*)['"]/g,o=e.readFileSync(t,"utf8").matchAll(r);for(const e of o)e[1].split(",").map((e=>e.trim())).forEach((e=>{n.add(e)}))}return n})(),o=le((()=>{const e=P();return t.resolve(C,(e.entry||"").replace(/^\//,""))})()),s=new Set;"element-ui"===n.resolvers&&o.forEach((t=>{const n=(t=>{const n=new Set,r=e.readFileSync(t,"utf-8"),o=r.matchAll(/<(?:el-|El)([^>\s]+)(?=[\s>])/g);for(const e of o){const t=e[1].replace(/^\w/,(e=>e.toUpperCase()));n.add(t)}const s=r.match(/\bv-loading(?::[^=>\s]+)?/g);s?.length&&n.add("Loading");const i=r.matchAll(/\$(?:msgbox|alert|confirm|prompt|notify|message)/g);for(const e of i){const t=e[0].substring(1);"msgbox"===t||"alert"===t||"confirm"===t||"prompt"===t?n.add("MessageBox"):"notify"===t?n.add("Notification"):"message"===t&&n.add("Message")}return n})(t);for(const e of n)s.add(e)}));let i=s.size!==r.size;if(!i)for(const e of s)if(!r.has(e)){i=!0;break}i?await ge(s):se("no update required")},ge=async o=>{const s=P();se(`generating ${s.output}...`);const i=ie();let l="";"element-ui"===s.resolvers&&(l=(e=>`\n    import { ${Array.from(e).join()} } from "element-ui"\n    import Vue from "vue"\n    \n    // 全局按需导入的组件列表\n    ${Array.from(e).map(ce).join("\n")}\n  `)(o));try{if(se(`formatting ${s.output}...`),l=r.format(l,{parser:"babel"}),s.check){se(`checking ${s.output}...`);const e=new n.ESLint({fix:!0}),[t]=await e.lintText(l);t.output&&(l=t.output)}}catch(e){oe.error(e.stack??e)}if(e.existsSync(i))e.unlinkSync(i);else{const n=t.dirname(i);n!==C&&e.mkdirSync(n,{recursive:!0})}e.writeFileSync(i,l),se(`${s.output} genarated!`)};class he{#e;constructor(e){this.#e=Object.assign({},T,e)}async apply(n){await(async n=>{M=Object.assign({},M,n);const r=t.resolve(C,M.ignorePath);if(e.existsSync(r)){const t=e.readFileSync(r).toString().replace(/\/$/gm,"");S.add(t)}})(this.#e),n.hooks.beforeCompile.tapAsync(he.name,((e,t)=>{ue().then((()=>{t()})).catch((e=>{t(e)}))}))}}module.exports=he;
