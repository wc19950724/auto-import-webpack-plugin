'use strict';

var _ = require('fs');
var A = require('path');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var ___default = /*#__PURE__*/_interopDefault(_);
var A__default = /*#__PURE__*/_interopDefault(A);

var At=Object.create;var P=Object.defineProperty;var Rt=Object.getOwnPropertyDescriptor;var vt=Object.getOwnPropertyNames;var wt=Object.getPrototypeOf,Pt=Object.prototype.hasOwnProperty;var $=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,o)=>(typeof require!="undefined"?require:e)[o]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var b=(t,e)=>()=>(t&&(e=t(t=0)),e);var V=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Lt=(t,e)=>{for(var o in e)P(t,o,{get:e[o],enumerable:!0});},Nt=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of vt(e))!Pt.call(t,r)&&r!==o&&P(t,r,{get:()=>e[r],enumerable:!(n=Rt(e,r))||n.enumerable});return t};var q=(t,e,o)=>(o=t!=null?At(wt(t)):{},Nt(e||!t||!t.__esModule?P(o,"default",{value:t,enumerable:!0}):o,t));var W=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)};var ae=(t,e,o)=>(W(t,e,"read from private field"),o?o.call(t):e.get(t)),ge=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o);},fe=(t,e,o,n)=>(W(t,e,"write to private field"),n?n.call(t,o):e.set(t,o),o);var d=(t,e,o)=>new Promise((n,r)=>{var s=p=>{try{c(o.next(p));}catch(g){r(g);}},i=p=>{try{c(o.throw(p));}catch(g){r(g);}},c=p=>p.done?n(p.value):Promise.resolve(p.value).then(s,i);c((o=o.apply(t,e)).next());});var et=V((le,tt)=>{function z(t){return Array.isArray(t)?t:[t]}var J="",H=" ",L="\\",It=/^\s+$/,jt=/(?:[^\\]|^)\\$/,Tt=/^\\!/,Ft=/^\\#/,Mt=/\r?\n/g,Gt=/^\.*\/|^\.+$/,N="/",U="node-ignore";typeof Symbol!="undefined"&&(U=Symbol.for("node-ignore"));var K=U,kt=(t,e,o)=>Object.defineProperty(t,e,{value:o}),Bt=/([0-z])-([0-z])/g,Q=()=>!1,Dt=t=>t.replace(Bt,(e,o,n)=>o.charCodeAt(0)<=n.charCodeAt(0)?e:J),Xt=t=>{let{length:e}=t;return t.slice(0,e-e%2)},Vt=[[/\\?\s+$/,t=>t.indexOf("\\")===0?H:J],[/\\\s/g,()=>H],[/[\\$.|*+(){^]/g,t=>`\\${t}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return /\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(t,e,o)=>e+6<o.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(t,e,o)=>{let n=o.replace(/\\\*/g,"[^\\/]*");return e+n}],[/\\\\\\(?=[$.|*+(){^])/g,()=>L],[/\\\\/g,()=>L],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(t,e,o,n,r)=>e===L?`\\[${o}${Xt(n)}${r}`:r==="]"&&n.length%2===0?`[${Dt(o)}${n}]`:"[]"],[/(?:[^*])$/,t=>/\/$/.test(t)?`${t}$`:`${t}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(t,e)=>`${e?`${e}[^/]+`:"[^/]*"}(?=$|\\/$)`]],Y=Object.create(null),qt=(t,e)=>{let o=Y[t];return o||(o=Vt.reduce((n,r)=>n.replace(r[0],r[1].bind(t)),t),Y[t]=o),e?new RegExp(o,"i"):new RegExp(o)},T=t=>typeof t=="string",Wt=t=>t&&T(t)&&!It.test(t)&&!jt.test(t)&&t.indexOf("#")!==0,zt=t=>t.split(Mt),I=class{constructor(e,o,n,r){this.origin=e,this.pattern=o,this.negative=n,this.regex=r;}},Ht=(t,e)=>{let o=t,n=!1;t.indexOf("!")===0&&(n=!0,t=t.substr(1)),t=t.replace(Tt,"!").replace(Ft,"#");let r=qt(t,e);return new I(o,t,n,r)},Kt=(t,e)=>{throw new e(t)},h=(t,e,o)=>T(t)?t?h.isNotRelative(t)?o(`path should be a \`path.relative()\`d string, but got "${e}"`,RangeError):!0:o("path must not be empty",TypeError):o(`path must be a string, but got \`${e}\``,TypeError),Z=t=>Gt.test(t);h.isNotRelative=Z;h.convert=t=>t;var j=class{constructor({ignorecase:e=!0,ignoreCase:o=e,allowRelativePaths:n=!1}={}){kt(this,K,!0),this._rules=[],this._ignoreCase=o,this._allowRelativePaths=n,this._initCache();}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null);}_addPattern(e){if(e&&e[K]){this._rules=this._rules.concat(e._rules),this._added=!0;return}if(Wt(e)){let o=Ht(e,this._ignoreCase);this._added=!0,this._rules.push(o);}}add(e){return this._added=!1,z(T(e)?zt(e):e).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,o){let n=!1,r=!1;return this._rules.forEach(s=>{let{negative:i}=s;if(r===i&&n!==r||i&&!n&&!r&&!o)return;s.regex.test(e)&&(n=!i,r=i);}),{ignored:n,unignored:r}}_test(e,o,n,r){let s=e&&h.convert(e);return h(s,e,this._allowRelativePaths?Q:Kt),this._t(s,o,n,r)}_t(e,o,n,r){if(e in o)return o[e];if(r||(r=e.split(N)),r.pop(),!r.length)return o[e]=this._testOne(e,n);let s=this._t(r.join(N)+N,o,n,r);return o[e]=s.ignored?s:this._testOne(e,n)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return z(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}},R=t=>new j(t),Yt=t=>h(t&&h.convert(t),t,Q);R.isPathValid=Yt;R.default=R;tt.exports=R;if(typeof process!="undefined"&&(process.env&&process.env.IGNORE_TEST_WIN32||process.platform==="win32")){let t=o=>/^\\\\\?\\/.test(o)||/["<>|\u0000-\u001F]+/u.test(o)?o:o.replace(/\\/g,"/");h.convert=t;let e=/^[a-z]:\//i;h.isNotRelative=o=>e.test(o)||Z(o);}});var ot,S;exports.h = void 0;exports.i = void 0;var f;exports.j = void 0;var u,rt,O,st,M,y,G,it,k,ct,B,at=b(()=>{ot=q(et());E();S=process.cwd(),exports.h={config:"atconfig.js"},exports.i={entry:".",output:"auto-import.js",library:"element-ui",ignore:".autoignore",logLevel:!0},f=exports.i,exports.j=t=>d(void 0,null,function*(){var e;if(Object.assign(f,t),!Array.isArray(f.ignore)){let o="";if(typeof f.ignore=="string"?o=A__default.default.resolve(S,f.ignore):(e=f.ignore)!=null&&e.path&&(o=A__default.default.resolve(S,f.ignore.path)),___default.default.existsSync(o)){let n=___default.default.readFileSync(o).toString().replace(/\/$/gm,"");rt.add(n);}}}),u=()=>f,rt=(0, ot.default)().add("node_modules").add("/.*"),O=t=>{if(typeof f.ignore=="string")return !1;let e;if(Array.isArray(f.ignore)?e=f.ignore:f.ignore.components&&(e=f.ignore.components),e)for(let o of e){if(o instanceof RegExp)return o.test(t);if(typeof o=="string")return G(o)===t}return !1},st=()=>A__default.default.resolve(process.cwd(),f.entry),M=()=>A__default.default.resolve(S,f.output),y=t=>x.success(`
[AUTO] ${t}`),G=t=>t.replace(/(?:^|-)(\w)/g,(e,o)=>o.toUpperCase()),it=()=>{let t=M(),e=new Set;if(___default.default.existsSync(t)){let o=___default.default.readFileSync(t,"utf8"),n=/import\s*{([^}]*)}\s*from\s*['"]([^'"]*)['"]/g,r=o.matchAll(n);for(let s of r)s[1].split(",").map(c=>c.trim()).filter(Boolean).forEach(c=>{e.add(c);});}return e},k=t=>{let e=___default.default.readdirSync(t,{withFileTypes:!0}),o=[];return e.forEach(n=>{if(rt.ignores(n.name))return;let r=A__default.default.resolve(t,n.name),s=___default.default.statSync(r);s.isDirectory()?o.push(...k(r)):s.isFile()&&n.name.endsWith(".vue")&&(x.gray(r),o.push(r));}),o},ct=(t,e)=>e instanceof RegExp?String(e):e,B=t=>{let e=t;if(Array.isArray(t))e=t.map(o=>B(o));else if(typeof t=="string"&&t.startsWith("/")&&t.lastIndexOf("/")>0){let o=t.slice(t.lastIndexOf("/")+1),n=t.slice(1,t.lastIndexOf("/"));e=new RegExp(n,o);}return e};});var pt=V((ye,D)=>{var Jt=$("tty"),Ut=!("NO_COLOR"in process.env||process.argv.includes("--no-color"))&&("FORCE_COLOR"in process.env||process.argv.includes("--color")||process.platform==="win32"||Jt.isatty(1)&&process.env.TERM!=="dumb"||"CI"in process.env),a=(t,e,o=t)=>n=>{let r=""+n,s=r.indexOf(e,t.length);return ~s?t+gt(r,e,o,s)+e:t+r+e},gt=(t,e,o,n)=>{let r=t.substring(0,n)+o,s=t.substring(n+e.length),i=s.indexOf(e);return ~i?r+gt(s,e,o,i):r+s},ft=(t=Ut)=>({isColorSupported:t,reset:t?e=>`\x1B[0m${e}\x1B[0m`:String,bold:t?a("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"):String,dim:t?a("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"):String,italic:t?a("\x1B[3m","\x1B[23m"):String,underline:t?a("\x1B[4m","\x1B[24m"):String,inverse:t?a("\x1B[7m","\x1B[27m"):String,hidden:t?a("\x1B[8m","\x1B[28m"):String,strikethrough:t?a("\x1B[9m","\x1B[29m"):String,black:t?a("\x1B[30m","\x1B[39m"):String,red:t?a("\x1B[31m","\x1B[39m"):String,green:t?a("\x1B[32m","\x1B[39m"):String,yellow:t?a("\x1B[33m","\x1B[39m"):String,blue:t?a("\x1B[34m","\x1B[39m"):String,magenta:t?a("\x1B[35m","\x1B[39m"):String,cyan:t?a("\x1B[36m","\x1B[39m"):String,white:t?a("\x1B[37m","\x1B[39m"):String,gray:t?a("\x1B[90m","\x1B[39m"):String,bgBlack:t?a("\x1B[40m","\x1B[49m"):String,bgRed:t?a("\x1B[41m","\x1B[49m"):String,bgGreen:t?a("\x1B[42m","\x1B[49m"):String,bgYellow:t?a("\x1B[43m","\x1B[49m"):String,bgBlue:t?a("\x1B[44m","\x1B[49m"):String,bgMagenta:t?a("\x1B[45m","\x1B[49m"):String,bgCyan:t?a("\x1B[46m","\x1B[49m"):String,bgWhite:t?a("\x1B[47m","\x1B[49m"):String});D.exports=ft();D.exports.createColors=ft;});var x={};Lt(x,{default:()=>Qt,error:()=>lt,gray:()=>ht,info:()=>ut,log:()=>dt,success:()=>xt,warn:()=>mt});var C,lt,mt,ut,xt,dt,ht,Qt,yt=b(()=>{C=q(pt());E();lt=t=>{let{logLevel:e}=u();e&&["error","warn","info",!0].indexOf(e)>-1&&console.log(C.default.red(t));},mt=t=>{let{logLevel:e}=u();e&&["warn","info",!0].indexOf(e)>-1&&console.log(C.default.yellow(t));},ut=t=>{let{logLevel:e}=u();e&&["info",!0].indexOf(e)>-1&&console.log(C.default.blue(t));},xt=t=>{let{logLevel:e}=u();e&&["info",!0].indexOf(e)>-1&&console.log(C.default.green(t));},dt=(...t)=>{let{logLevel:e}=u();e&&["info",!0].indexOf(e)>-1&&console.log(...t);},ht=t=>{let{logLevel:e}=u();e&&["info",!0].indexOf(e)>-1&&console.log(C.default.gray(t));},Qt={error:lt,warn:mt,info:ut,success:xt,log:dt,gray:ht};});var E=b(()=>{St();at();yt();});var _t;exports.g = void 0;var St=b(()=>{E();_t=t=>d(void 0,null,function*(){var r;let e={},o=A__default.default.join(S,t),n=A__default.default.extname(t).slice(1);if(___default.default.existsSync(o)){if(n==="json"){let s=___default.default.readFileSync(o,"utf8"),i=JSON.parse(s);for(let c in i)i[c]=B(i[c]);Object.assign(e,i);}else if(n==="js"){let s=$(o);Object.assign(e,s);}}else {let s="",i=JSON.stringify(exports.i,ct,2);if(n==="json"?s=i:n==="js"&&(s=`module.exports = ${i.replace(/"([^"]+)":/g,"$1:").replace(/"([^"]+)"/g,(l,m)=>{if(m.startsWith("/")&&m.lastIndexOf("/")>0){let $t=m.slice(m.lastIndexOf("/")+1);return `/${m.slice(1,m.lastIndexOf("/"))}/${$t}`}else return l})}`),!s)throw new Error(`${t}: write config is failed`);let{ESLint:c}=$("eslint"),g=yield new c({fix:!0,cache:!0}).lintText(s);s=((r=g==null?void 0:g[0])==null?void 0:r.output)||s,___default.default.writeFileSync(o,s),y("generating default config"),x.gray(o),Object.assign(e,exports.i);}return e}),exports.g=t=>d(void 0,null,function*(){let e={};for(let o in t)if(o==="config"){let n=t[o]||exports.h.config;Object.assign(e,yield _t(n));}if(!Object.keys(e).length){let o=exports.h.config;Object.assign(e,yield _t(o));}return e});});var te,Ot,ee,Et,Ct=b(()=>{E();te={Loading:{use:"Loading.directive",prototype:{loading:"Loading.service"}},MessageBox:{prototype:{msgbox:"MessageBox",alert:"MessageBox.alert",confirm:"MessageBox.confirm",prompt:"MessageBox.prompt"}},Notification:{prototype:{notify:"Notification"}},Message:{prototype:{message:"Message"}}},Ot=t=>{let e=new Set,o=_.readFileSync(t,"utf-8"),n=/<(?:el-|El)([^>\s]+)(?=[\s>])/g,r=/\bv-loading(?::[^=>\s]+)?/g,s=/\$(?:msgbox|alert|confirm|prompt|notify|message)/g,i=o.matchAll(n),c=new Set;for(let g of i){let l=g[1],m=G(l);if(O(m)){c.add(m);continue}e.add(m);}if(O("Loading"))c.add("Loading");else {let g=o.match(r);g!=null&&g.length&&e.add("Loading");}let p=o.matchAll(s);for(let g of p){let l=g[0].substring(1);if(l==="msgbox"||l==="alert"||l==="confirm"||l==="prompt"){if(O("MessageBox")){c.add("MessageBox");continue}e.add("MessageBox");}else if(l==="notify"){if(O("Notification")){c.add("Notification");continue}e.add("Notification");}else if(l==="message"){if(O("Message")){c.add("Message");continue}e.add("Message");}}if(c.size>0){y("Ignore Components");for(let g of c)x.gray(g);}return e},ee=t=>{let e=te[t];if(!e)return `Vue.use(${t})`;let{use:o,prototype:n}=e,r=[];if(o&&r.push(`Vue.use(${o});`),n){let s=Object.entries(n).map(([i,c])=>`Vue.prototype.$${i} = ${c};`);r.push(...s);}return r.join(`
`)},Et=t=>{let e=`import { ${Array.from(t).join()} } from "element-ui"`,o=Array.from(t).map(ee);return `
    ${e}
    import Vue from "vue"
    
    // \u5168\u5C40\u6309\u9700\u5BFC\u5165\u7684\u7EC4\u4EF6\u5217\u8868
    ${o.join(`
`)}
  `};});exports.m = void 0;var re,se;exports.n = void 0;var ie=b(()=>{Ct();E();exports.m=()=>d(void 0,null,function*(){let t=u();y("scanning files...");let e=it(),o=k(st()),n=new Set;t.library==="element-ui"&&o.forEach(s=>{let i=Ot(s);for(let c of i)n.add(c);});let r=n.size!==e.size;if(!r){for(let s of n)if(!e.has(s)){r=!0;break}}if(!r){y("no update required");return}yield re(n);}),re=t=>d(void 0,null,function*(){var c;let e=u();y(`generating ${e.output}...`);let o=M(),n="";e.library==="element-ui"&&(n=Et(t));let{ESLint:r}=$("eslint"),i=yield new r({fix:!0,cache:!0}).lintText(n);if(n=((c=i==null?void 0:i[0])==null?void 0:c.output)||n,___default.default.existsSync(o))___default.default.unlinkSync(o);else {let p=A__default.default.dirname(o);p!==S&&___default.default.mkdirSync(p,{recursive:!0});}___default.default.writeFileSync(o,n),y(`${e.output} genarated!`);}),se=t=>d(void 0,null,function*(){yield exports.j(t),yield exports.m();}),exports.n=se;});

exports.a = b;
exports.b = V;
exports.c = ae;
exports.d = ge;
exports.e = fe;
exports.f = d;
exports.k = x;
exports.l = E;
exports.o = ie;
